<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>CRUD Livros [v05]</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container py-4">
  <h2>Cadastro de Livros [v05]</h2>

  <form id="livroForm">
    <input type="hidden" id="livroId">
    <div class="mb-3">
      <input type="text" id="titulo" class="form-control" placeholder="Título" required />
    </div>
    <div class="mb-3">
      <input type="text" id="autor" class="form-control" placeholder="Autor" required />
    </div>
    <div class="mb-3">
      <input type="number" id="ano" class="form-control" placeholder="Ano" required />
    </div>
    <button type="submit" class="btn btn-primary">Salvar</button>
  </form>

  <hr />

  <h3>Lista de Livros</h3>
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Título</th>
        <th>Autor</th>
        <th>Ano</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody id="livrosTable"></tbody>
  </table>

  <script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbx7Pz-J6xNu8i4BA_SIIyVT_Oyd0Sc5ffN0wHfTxR8BkuAikXh0t-qCL-TIZdWz_gCn/exec';

    async function carregarLivros() {
      const res = await fetch(API_URL);
      const livros = await res.json();
      const table = document.getElementById("livrosTable");
      table.innerHTML = "";

      livros.forEach(livro => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${livro.titulo}</td>
          <td>${livro.autor}</td>
          <td>${livro.ano}</td>
          <td>
            <button class="btn btn-sm btn-warning" onclick='editar(${JSON.stringify(livro)})'>Editar</button>
            <button class="btn btn-sm btn-danger" onclick='deletar(${livro.id})'>Excluir</button>
          </td>
        `;
        table.appendChild(tr);
      });
    }

    document.getElementById("livroForm").addEventListener("submit", async e => {
      e.preventDefault();
      const id = document.getElementById("livroId").value;
      const data = {
        titulo: document.getElementById("titulo").value,
        autor: document.getElementById("autor").value,
        ano: document.getElementById("ano").value,
        id: id || undefined
      };

      if (id) {
        await fetch(API_URL, {
          method: "PUT",
          body: JSON.stringify(data)
        });
      } else {
        await fetch(API_URL, {
          method: "POST",
          body: JSON.stringify(data)
        });
      }

      e.target.reset();
      document.getElementById("livroId").value = "";
      carregarLivros();
    });

    function editar(livro) {
      document.getElementById("livroId").value = livro.id;
      document.getElementById("titulo").value = livro.titulo;
      document.getElementById("autor").value = livro.autor;
      document.getElementById("ano").value = livro.ano;
    }

    async function deletar(id) {
      await fetch(`${API_URL}?id=${id}`, { method: "DELETE" });
      carregarLivros();
    }

    carregarLivros();
  </script>
</body>
</html>
